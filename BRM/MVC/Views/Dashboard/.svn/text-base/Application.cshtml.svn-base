@model BRM.Models.Projects
@{
    ViewBag.Title = "Application";
}

<h2>Application</h2>
<script src="~/Scripts/angular.js"></script>

<script>
    $(document).ready(function () {
        $('select').material_select();
    });
</script>

<script>
    var myApp = angular.module('myApp', [])
        .controller("myCtrl", ['$scope', '$http',
            function ($scope, $http) {
                $http.get("/Dashboard/GetApplication").then(function (responses) {
                    $scope.names = responses.data;
                });

                $scope.GetRelease = function () {
                    if ($scope.Application)
                        $http.post("/Dashboard/GetRelease/" + $scope.Application.ID, JSON.stringify({ ID: $scope.Application })).then(function (response) {
                            $scope.release = response.data;
                        });
                }

                $scope.GetChange = function () {
                    $http.get("/Dashboard/GetChanges").then(function (response) {
                        debugger;
                        $scope.change = response.data;
                    });
                }

                $scope.GetEnvironment = function () {
                    if ($scope.Release)
                        $http.post("/Dashboard/GetEnvironment/" + $scope.Release.ID, JSON.stringify({ ID: $scope.Release })).then(function (response) {
                            $scope.environment = response.data;
                        });
                }

                $scope.GetServer = function () {
                    if ($scope.Environment)
                        $http.post("/Dashboard/GetServer/" + $scope.Environment.ID, JSON.stringify({ ID: $scope.Environment })).then(function (response) {
                            $scope.server = response.data;
                        });
                }
                $scope.SaveDetails = function () {
                    debugger;
                    var UserID = '@Session["ID"]';
                    var ID ={ "Application_ID": $scope.Application.ID, "Release_ID": $scope.Release.ID, "Change_ID": $scope.Change.ID, "Environment_ID": $scope.Environment.ID, "Server_ID": $scope.Server.ID, "User_ID": UserID };


                    if ($scope.Application || $scope.Release || $scope.Change || $scope.Environment || $scope.Server)
                        $http({
                            method: 'POST',
                            url: '/Dashboard/SaveDetails/',
                            data: { Application_ID: $scope.Application.ID, Release_ID: $scope.Release.ID, Change_ID: $scope.Change.ID, Environment_ID: $scope.Environment.ID, Server_ID: $scope.Server.ID, User_ID: UserID },
                        }).then(function () {
                            alert("Saved Successfully");
                        });
                }
            }]);
</script>


<div>
    @if (Session["UserName"] != null)
    { <text>
        Welcome @Session["UserName"].ToString() </text>

    }
</div>
<html ng-app="myApp">
<head>
    <title></title>
    <meta charset="utf-8" />
</head>
<body ng-controller="myCtrl">

    <div class="row">
        <div class="input-field col s2">
            <select class="browser-default" ng-change="GetRelease()" ng-options="a as a.Name for a in names" ng-model="Application">
                <option value="">--Select Application--</option>
            </select>
        </div>

        <div class="input-field col s2">
            <select class="browser-default" ng-model="Release" ng-change="GetChange()" ng-options="r as r.Name for r in release">
                <option value="">--Select Release--</option>
            </select>
        </div>

        <div class="input-field col s2">
            <select class="browser-default" ng-model="Change" ng-change="GetEnvironment()" ng-options="c as c.value for c in change">
                <option value="">--Select Change--</option>
            </select>
        </div>

        <div class="input-field col s2">
            <select class="browser-default" ng-model="Environment" ng-change="GetServer()" ng-options="e as e.value for e in environment">
                <option value="">--Select Environment--</option>
            </select>
        </div>

        <div class="input-field col s2">
            <select class="browser-default" ng-model="Server" ng-options="s as s.Name for s in server">
                <option value="">--Select Server--</option>
            </select>
        </div>
    </div>

    <div>
        <p>Application Selected: {{Application.Name}}</p>
        <p>Release Selected: {{Release.Name}}</p>
        <p>Changes Made: {{Change.value}}</p>
        <p>Environment Selected: {{Environment.value}}</p>
        <p>Server Selected: {{Server.Name}}</p>
    </div>

    <div class="center-align">
        <button value="submit" id="BtnUpdate" type="submit" class="waves-effect grey darken-4 white-text waves-light btn-flat" ng-click="SaveDetails()">Update</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Application Name</th>
                <th>Release</th>
                <th>Modifications</th>
                <th>Environment</th>
                <th>Server</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>In Progress</td>
            </tr>
        </tbody>
    </table>

</body>
</html>
